# Navigation After Transition

Refer to [README.md](./README.md) for more information what's the overall strategy and why we're migrating away from `InteractionManager.runAfterInteractions`.

## Strategy

**Use `Navigation.navigate/goBack/dismissModal({afterTransition: callback})`**

Every usage in this file defers work until after a screen/modal transition completes. Replace each `InteractionManager.runAfterInteractions()` call with the `afterTransition` option available on Navigation methods.

`TransitionTracker.runAfterTransitions()` should **never** be called directly — it is already wired into `Navigation.ts` internally.

| File                                        | Line     | Current                                                       | Migration                                                                                                  | PR                                                                                                           |
| ------------------------------------------- | -------- | ------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| `IOU/index.ts`                              | 6374     | `removeDraftTransactions()` after split bill                  | Pass as `afterTransition` to the navigation call in `handleNavigateAfterExpenseCreate`                     | [#61574](https://github.com/Expensify/App/pull/61574)                                                        |
| `IOU/index.ts`                              | 6501     | `removeDraftTransaction()` after per diem                     | Same — thread through navigation                                                                           | [#54760](https://github.com/Expensify/App/pull/54760)                                                        |
| `IOU/index.ts`                              | 6834     | `removeDraftTransactions()` after distance request            | Same                                                                                                       | [#78109](https://github.com/Expensify/App/pull/78109)                                                        |
| `IOU/index.ts`                              | 7522     | `removeDraftTransaction()`                                    | Same                                                                                                       | [#53852](https://github.com/Expensify/App/pull/53852)                                                        |
| `IOU/index.ts`                              | 7613     | `removeDraftTransaction()`                                    | Same                                                                                                       | [#51940](https://github.com/Expensify/App/pull/51940)                                                        |
| `IOU/index.ts`                              | 8281     | `removeDraftTransaction()`                                    | Same                                                                                                       | [#51940](https://github.com/Expensify/App/pull/51940)                                                        |
| `IOU/index.ts`                              | 8539     | `removeDraftTransaction()`                                    | Same                                                                                                       | [#51940](https://github.com/Expensify/App/pull/51940)                                                        |
| `IOU/index.ts`                              | 9059     | Clear draft transaction data                                  | Same                                                                                                       | [#51940](https://github.com/Expensify/App/pull/51940)                                                        |
| `IOU/index.ts`                              | 14208    | `removeDraftSplitTransaction()`                               | Same                                                                                                       | [#79648](https://github.com/Expensify/App/pull/79648)                                                        |
| `IOU/SendInvoice.ts`                        | 787      | `removeDraftTransaction()` after invoice                      | Same                                                                                                       | [#78512](https://github.com/Expensify/App/pull/78512)                                                        |
| `Task.ts`                                   | 319      | `clearOutTaskInfo()` + `dismissModalWithReport`               | Use `dismissModalWithReport({afterTransition: () => clearOutTaskInfo()})`                                  | [#57864](https://github.com/Expensify/App/pull/57864)                                                        |
| `ConfirmationStep.tsx`                      | 76       | `clearAssignCardStepAndData()` after `dismissModal()`         | Use `Navigation.dismissModal({afterTransition: () => clearAssignCardStepAndData()})`                       | [#58630](https://github.com/Expensify/App/pull/58630)                                                        |
| `TwoFactorAuthActions.ts`                   | 28       | `clearTwoFactorAuthData()` after `goBack()`                   | Use `Navigation.goBack({afterTransition: () => clearTwoFactorAuthData()})`                                 | [#54404](https://github.com/Expensify/App/pull/54404)                                                        |
| `Report/index.ts`                           | 1176     | `clearGroupChat()` during creation                            | Use `Navigation.afterTransition` on the subsequent navigation                                              | [#57864](https://github.com/Expensify/App/pull/57864)                                                        |
| `Report/index.ts`                           | 1909     | Clear report data                                             | Navigation afterTransition                                                                                 | [#47033](https://github.com/Expensify/App/pull/47033)                                                        |
| `Report/index.ts`                           | 3328     | `deleteReport()` after `goBack()/popToSidebar()`              | `Navigation.goBack({afterTransition: () => deleteReport()})`                                               | [#66890](https://github.com/Expensify/App/pull/66890)                                                        |
| `Report/index.ts`                           | 5814     | Clear report data                                             | Navigation afterTransition                                                                                 | [#66890](https://github.com/Expensify/App/pull/66890)                                                        |
| `MoneyRequestReportView.tsx`                | 137      | `removeFailedReport()` after `goBackFromSearchMoneyRequest()` | Thread afterTransition through goBack                                                                      | [#59386](https://github.com/Expensify/App/pull/59386)                                                        |
| `ReportScreen.tsx`                          | 493      | Clear `deleteTransactionNavigateBackUrl`                      | `Navigation.afterTransition` (post-navigation cleanup)                                                     | [#52740](https://github.com/Expensify/App/pull/52740)                                                        |
| `ReportScreen.tsx`                          | 681      | `setShouldShowComposeInput(true)` on mount                    | `Navigation.afterTransition` (show after screen entry)                                                     | [#38255](https://github.com/Expensify/App/pull/38255)                                                        |
| `ReportScreen.tsx`                          | 884      | Subscribe to report leaving events                            | `Navigation.afterTransition` (after report screen loads)                                                   | [#30269](https://github.com/Expensify/App/pull/30269)                                                        |
| `ReportActionsView.tsx`                     | 286      | Set `navigatingToLinkedMessage` state                         | `Navigation.afterTransition` then `setTimeout(10)`                                                         | [#30269](https://github.com/Expensify/App/pull/30269)                                                        |
| `BaseReportActionContextMenu.tsx`           | 317      | `signOutAndRedirectToSignIn()` after hiding menu              | Use context menu's `hideContextMenu` callback with afterTransition                                         | [#33715](https://github.com/Expensify/App/pull/33715)                                                        |
| `PureReportActionItem.tsx`                  | 1740     | Sign out and redirect                                         | `Navigation.navigate({afterTransition})` or `requestAnimationFrame`                                        | [#52948](https://github.com/Expensify/App/pull/52948)                                                        |
| `MoneyReportHeader.tsx`                     | 1503     | Delete transaction after nav setup                            | `Navigation.goBack({afterTransition: () => deleteTransactions()})`                                         | [#74605](https://github.com/Expensify/App/pull/74605)                                                        |
| `MoneyReportHeader.tsx`                     | 1526     | Delete report after goBack                                    | `Navigation.goBack({afterTransition: () => deleteAppReport()})`                                            | [#79539](https://github.com/Expensify/App/pull/79539)                                                        |
| `StatusPage.tsx`                            | 136      | `clearDraftCustomStatus()` + navigate                         | Remove navigateBackToPreviousScreenTask and use `Navigation.goBack({afterTransition: () => clearDraft()})` | [#40364](https://github.com/Expensify/App/pull/40364)                                                        |
| `StatusPage.tsx`                            | 157      | Navigate back after status action                             | Remove navigateBackToPreviousScreenTask and use `Navigation.goBack({afterTransition})`                     | [#40364](https://github.com/Expensify/App/pull/40364)                                                        |
| `TwoFactorAuth/VerifyPage.tsx`              | 79       | 2FA verify navigation                                         | Investigate if InteractionManager is needed                                                                | [#67762](https://github.com/Expensify/App/pull/67762)                                                        |
| `DebugReportActionPage.tsx`                 | 69       | Defer deletion during nav                                     | Use `Navigation.goBack({afterTransition: () => deleteAction()})`                                           | [#53655](https://github.com/Expensify/App/pull/53655)                                                        |
| `DebugTransactionPage.tsx`                  | 65       | Defer transaction deletion                                    | Use `Navigation.goBack({afterTransition: () => deleteTx()})`                                               | [#53655](https://github.com/Expensify/App/pull/53655)                                                        |
| `DebugTransactionViolationPage.tsx`         | 53       | Defer violation deletion                                      | Use `Navigation.goBack({afterTransition: () => deleteViolation()})`                                        | [#53969](https://github.com/Expensify/App/pull/53969)                                                        |
| `AddUnreportedExpenseFooter.tsx`            | 57       | Bulk convert after `dismissToSuperWideRHP()`                  | Use `Navigation.dismissToSuperWideRHP({afterTransition: () => convert()})`                                 | [#79328](https://github.com/Expensify/App/pull/79328)                                                        |
| `RightModalNavigator.tsx`                   | 130, 198 | Save scroll offsets / clear 2FA                               | Use `Navigation.afterTransition` in the navigator                                                          | [#69531](https://github.com/Expensify/App/pull/69531), [#79473](https://github.com/Expensify/App/pull/79473) |
| `NetSuiteImportAddCustomSegmentContent.tsx` | 51       | NetSuite segment navigation                                   | Navigation afterTransition                                                                                 | [#51109](https://github.com/Expensify/App/pull/51109)                                                        |
| `NetSuiteImportAddCustomListContent.tsx`    | 48       | NetSuite list navigation                                      | Navigation afterTransition                                                                                 | [#51109](https://github.com/Expensify/App/pull/51109)                                                        |


